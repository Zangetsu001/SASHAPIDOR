@model string
@using EduMaster.Domain.ModelsDb

<div class="dashboard-wrapper">

    <!-- Шапка -->
    <div class="dashboard-header">
        <h2>Личный кабинет</h2>
        <div class="user-badge">
            <i class="fa fa-user-circle"></i>
            <span>@Model</span>
        </div>
    </div>

    <!-- Меню вкладок -->
    <div class="custom-nav-tabs">
        <button class="nav-link-custom active" onclick="openTab(event, 'tab-courses')">Мои курсы</button>
        <button class="nav-link-custom" onclick="openTab(event, 'tab-settings')">Настройки</button>
    </div>

    <!-- Контент: МОИ КУРСЫ -->
    <div id="tab-courses" class="tab-content-item" style="display:block;">

        @if (ViewBag.MyCourses != null && ((List<CourseDb>)ViewBag.MyCourses).Any())
        {
            <div class="cabinet-courses-grid">
                @foreach (var course in (List<CourseDb>)ViewBag.MyCourses)
                {
                    <div class="cabinet-course-card">
                        <div class="cabinet-img-wrapper">
                            <div class="status-badge">Вы записаны</div>
                            <!-- Грузим картинку -->
                            <img src="@Url.Action("GetImage", "Courses", new { courseId = course.Id })"
                                 alt="@course.title"
                                 class="cabinet-img"
                                 onerror="this.style.display='none';" />
                            <!-- Заглушка под картинкой -->
                            <div style="position:absolute; top:0; left:0; width:100%; height:100%; background:#eee; z-index:-1;"></div>
                        </div>

                        <div class="cabinet-card-body">
                            <h4 class="cabinet-card-title">@course.title</h4>
                            <p class="cabinet-card-desc">@course.description</p>

                            <div class="cabinet-card-footer">
                                <span class="price-tag">@course.price.ToString("N0") ₽</span>
                                <button class="btn-remove" onclick="removeCourse('@course.Id', this)">
                                    <i class="fa fa-times"></i> Отказаться
                                </button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="empty-cabinet">
                <i class="fa fa-graduation-cap"></i>
                <h4>Список курсов пуст</h4>
                <p>Перейдите в каталог и выберите что-нибудь интересное.</p>
                <a href="/Courses/Catalog" class="btn-go-catalog">В каталог</a>
            </div>
        }
    </div>

    <!-- Контент: НАСТРОЙКИ -->
    <div id="tab-settings" class="tab-content-item" style="display:none;">
        <div class="settings-box">
            <div class="settings-avatar"><i class="fa fa-user"></i></div>
            <h4>@Model</h4>
            <p class="text-muted">Профиль активен</p>
        </div>
    </div>

</div>

<script>
    // Переключение вкладок (без jQuery и Bootstrap JS, чтобы не конфликтовало)
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;

        // Скрываем все вкладки
        tabcontent = document.getElementsByClassName("tab-content-item");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Убираем класс active у кнопок
        tablinks = document.getElementsByClassName("nav-link-custom");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // Показываем текущую
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }

    // Удаление курса
    function removeCourse(id, btn) {
        if(!confirm("Удалить курс из списка?")) return;

        btn.disabled = true;
        btn.innerHTML = "...";

        fetch('/Home/RemoveCourse?id=' + id, { method: 'POST' })
            .then(res => res.json())
            .then(data => {
                if(data.success) location.reload();
                else alert("Ошибка удаления");
            });
    }
</script>
@section Scripts {
    <script src="~/js/courses_script.js" asp-append-version="true"></script>
}